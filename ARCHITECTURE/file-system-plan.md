# üìÅ –ü–ª–∞–Ω —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ —Å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –ø–æ –¥–∞—Ç–∞–º, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Ñ–∞–π–ª–æ–≤.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–æ –¥–∞—Ç–∞–º
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
- [ ] –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
- [ ] –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–ø–∫–∞ uploads/
- [ ] –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫

```
uploads/
‚îú‚îÄ‚îÄ 2024/
‚îÇ   ‚îú‚îÄ‚îÄ 01/                    # –Ø–Ω–≤–∞—Ä—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 15/               # 15 —è–Ω–≤–∞—Ä—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ file1.pdf
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file2.docx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 20/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ file3.pdf
‚îÇ   ‚îú‚îÄ‚îÄ 02/                    # –§–µ–≤—Ä–∞–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ 03/
‚îú‚îÄ‚îÄ temp/                      # –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ processing/           # –§–∞–π–ª—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ
‚îÇ   ‚îî‚îÄ‚îÄ cleanup/              # –§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ backups/                   # –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ 2024-01-15/
‚îÇ   ‚îî‚îÄ‚îÄ 2024-01-20/
‚îî‚îÄ‚îÄ logs/                      # –õ–æ–≥–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
    ‚îú‚îÄ‚îÄ uploads.log
    ‚îú‚îÄ‚îÄ errors.log
    ‚îî‚îÄ‚îÄ cleanup.log
```

## üîß –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã (`src/lib/file-config.ts`)

```typescript
export const FILE_CONFIG = {
  // –ü—É—Ç–∏
  UPLOADS_DIR: 'uploads',
  TEMP_DIR: 'uploads/temp',
  PROCESSING_DIR: 'uploads/temp/processing',
  CLEANUP_DIR: 'uploads/temp/cleanup',
  BACKUPS_DIR: 'uploads/backups',
  LOGS_DIR: 'uploads/logs',

  // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  MAX_FILE_SIZE: 50 * 1024 * 1024, // 50MB
  MAX_FILES_PER_DAY: 100,
  ALLOWED_MIME_TYPES: [
    'application/pdf',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'text/plain',
    'application/epub+zip',
    'application/x-fictionbook+xml'
  ],

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞–Ω–∫–∏–Ω–≥–∞
  CHUNK_SIZE: 1000, // —Å–∏–º–≤–æ–ª–æ–≤
  CHUNK_OVERLAP: 200, // —Å–∏–º–≤–æ–ª–æ–≤

  // –û—á–∏—Å—Ç–∫–∞
  CLEANUP_DAYS: 30, // –£–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
  BACKUP_DAYS: 7,   // –•—Ä–∞–Ω–∏—Ç—å –±—ç–∫–∞–ø—ã 7 –¥–Ω–µ–π

  // –í–∞–ª–∏–¥–∞—Ü–∏—è
  MIN_FILE_SIZE: 1024, // 1KB
  MAX_FILENAME_LENGTH: 255
} as const

export type AllowedMimeType = typeof FILE_CONFIG.ALLOWED_MIME_TYPES[number]
```

### 2. –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ (`src/lib/file-utils.ts`)

```typescript
import fs from 'fs/promises'
import path from 'path'
import { FILE_CONFIG } from './file-config'
import { randomUUID } from 'crypto'

export class FileUtils {
  /**
   * –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è –¥–∞—Ç—ã
   */
  static async createDateFolders(date: Date = new Date()): Promise<string> {
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    
    const datePath = path.join(FILE_CONFIG.UPLOADS_DIR, String(year), month, day)
    
    await fs.mkdir(datePath, { recursive: true })
    return datePath
  }

  /**
   * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
   */
  static generateFilename(originalName: string): string {
    const ext = path.extname(originalName)
    const baseName = path.basename(originalName, ext)
    const uuid = randomUUID()
    
    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    const maxBaseLength = FILE_CONFIG.MAX_FILENAME_LENGTH - ext.length - uuid.length - 2
    const truncatedBase = baseName.length > maxBaseLength 
      ? baseName.substring(0, maxBaseLength) 
      : baseName
    
    return `${truncatedBase}_${uuid}${ext}`
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç –ø—É—Ç—å –¥–ª—è —Ñ–∞–π–ª–∞ –ø–æ –¥–∞—Ç–µ
   */
  static getFilePath(filename: string, date: Date = new Date()): string {
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    
    return path.join(FILE_CONFIG.UPLOADS_DIR, String(year), month, day, filename)
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
   */
  static async checkDiskSpace(): Promise<{
    free: number
    total: number
    used: number
    percentage: number
  }> {
    // –î–ª—è Node.js –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω—é—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É
    // –ù–∞–ø—Ä–∏–º–µ—Ä: diskusage –∏–ª–∏ node-disk-info
    // –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
    return {
      free: 1024 * 1024 * 1024 * 10, // 10GB
      total: 1024 * 1024 * 1024 * 100, // 100GB
      used: 1024 * 1024 * 1024 * 90, // 90GB
      percentage: 90
    }
  }

  /**
   * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–∞–π–ª
   */
  static validateFile(file: {
    size: number
    mimetype: string
    originalname: string
  }): { valid: boolean; error?: string } {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
    if (file.size < FILE_CONFIG.MIN_FILE_SIZE) {
      return { valid: false, error: '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π' }
    }

    if (file.size > FILE_CONFIG.MAX_FILE_SIZE) {
      return { valid: false, error: '–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π' }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞
    if (!FILE_CONFIG.ALLOWED_MIME_TYPES.includes(file.mimetype as any)) {
      return { valid: false, error: '–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞' }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    if (file.originalname.length > FILE_CONFIG.MAX_FILENAME_LENGTH) {
      return { valid: false, error: '–ò–º—è —Ñ–∞–π–ª–∞ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ' }
    }

    return { valid: true }
  }

  /**
   * –°–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
   */
  static async createTempFolder(): Promise<string> {
    const tempId = randomUUID()
    const tempPath = path.join(FILE_CONFIG.PROCESSING_DIR, tempId)
    
    await fs.mkdir(tempPath, { recursive: true })
    return tempPath
  }

  /**
   * –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–∞–π–ª –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É
   */
  static async moveToFinalLocation(
    tempPath: string, 
    finalPath: string
  ): Promise<void> {
    await fs.mkdir(path.dirname(finalPath), { recursive: true })
    await fs.rename(tempPath, finalPath)
  }

  /**
   * –ë–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª—è–µ—Ç —Ñ–∞–π–ª
   */
  static async deleteFile(filePath: string): Promise<void> {
    try {
      await fs.unlink(filePath)
    } catch (error) {
      // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –Ω–µ –ø–∞–¥–∞–µ–º
      console.error(`Error deleting file ${filePath}:`, error)
    }
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø–∞–ø–∫–∏
   */
  static async getFolderSize(folderPath: string): Promise<number> {
    let totalSize = 0
    
    const files = await fs.readdir(folderPath, { withFileTypes: true })
    
    for (const file of files) {
      const filePath = path.join(folderPath, file.name)
      
      if (file.isDirectory()) {
        totalSize += await this.getFolderSize(filePath)
      } else {
        const stats = await fs.stat(filePath)
        totalSize += stats.size
      }
    }
    
    return totalSize
  }
}
```

### 3. –ú–µ–Ω–µ–¥–∂–µ—Ä —Ñ–∞–π–ª–æ–≤ (`src/lib/file-manager.ts`)

```typescript
import { FileUtils } from './file-utils'
import { FILE_CONFIG } from './file-config'
import fs from 'fs/promises'
import path from 'path'
import { createHash } from 'crypto'

export class FileManager {
  /**
   * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
   */
  static async saveUploadedFile(
    tempPath: string,
    originalName: string,
    mimetype: string
  ): Promise<{
    filename: string
    filePath: string
    fileHash: string
    fileSize: number
  }> {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ
    const diskSpace = await FileUtils.checkDiskSpace()
    if (diskSpace.percentage > 95) {
      throw new Error('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ')
    }

    // –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫–∏ –¥–ª—è –¥–∞—Ç—ã
    const dateFolder = await FileUtils.createDateFolders()
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    const filename = FileUtils.generateFilename(originalName)
    const finalPath = path.join(dateFolder, filename)
    
    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º —Ñ–∞–π–ª
    await FileUtils.moveToFinalLocation(tempPath, finalPath)
    
    // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
    const stats = await fs.stat(finalPath)
    const fileHash = await this.calculateFileHash(finalPath)
    
    return {
      filename,
      filePath: finalPath,
      fileHash,
      fileSize: stats.size
    }
  }

  /**
   * –í—ã—á–∏—Å–ª—è–µ—Ç —Ö–µ—à —Ñ–∞–π–ª–∞
   */
  static async calculateFileHash(filePath: string): Promise<string> {
    const hash = createHash('md5')
    const fileBuffer = await fs.readFile(filePath)
    hash.update(fileBuffer)
    return hash.digest('hex')
  }

  /**
   * –û—á–∏—â–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
   */
  static async cleanupOldFiles(): Promise<{
    deletedFiles: number
    freedSpace: number
  }> {
    const cutoffDate = new Date()
    cutoffDate.setDate(cutoffDate.getDate() - FILE_CONFIG.CLEANUP_DAYS)
    
    let deletedFiles = 0
    let freedSpace = 0
    
    // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –ø–∞–ø–∫–∞–º –≤ uploads
    const uploadsPath = FILE_CONFIG.UPLOADS_DIR
    const years = await fs.readdir(uploadsPath)
    
    for (const year of years) {
      if (year === 'temp' || year === 'backups' || year === 'logs') continue
      
      const yearPath = path.join(uploadsPath, year)
      const months = await fs.readdir(yearPath)
      
      for (const month of months) {
        const monthPath = path.join(yearPath, month)
        const days = await fs.readdir(monthPath)
        
        for (const day of days) {
          const dayPath = path.join(monthPath, day)
          const dayDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day))
          
          if (dayDate < cutoffDate) {
            // –£–¥–∞–ª—è–µ–º –≤—Å—é –ø–∞–ø–∫—É –¥–Ω—è
            const folderSize = await FileUtils.getFolderSize(dayPath)
            await fs.rmdir(dayPath, { recursive: true })
            
            deletedFiles++
            freedSpace += folderSize
          }
        }
      }
    }
    
    return { deletedFiles, freedSpace }
  }

  /**
   * –°–æ–∑–¥–∞–µ—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é —Ñ–∞–π–ª–∞
   */
  static async backupFile(filePath: string): Promise<string> {
    const backupDate = new Date()
    const backupFolder = path.join(
      FILE_CONFIG.BACKUPS_DIR,
      backupDate.toISOString().split('T')[0]
    )
    
    await fs.mkdir(backupFolder, { recursive: true })
    
    const filename = path.basename(filePath)
    const backupPath = path.join(backupFolder, filename)
    
    await fs.copyFile(filePath, backupPath)
    
    return backupPath
  }

  /**
   * –ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
   */
  static async getFileSystemStats(): Promise<{
    totalFiles: number
    totalSize: number
    byType: Record<string, { count: number; size: number }>
    byDate: Record<string, { count: number; size: number }>
  }> {
    const stats = {
      totalFiles: 0,
      totalSize: 0,
      byType: {} as Record<string, { count: number; size: number }>,
      byDate: {} as Record<string, { count: number; size: number }>
    }
    
    // –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º
    await this.scanDirectory(FILE_CONFIG.UPLOADS_DIR, stats)
    
    return stats
  }

  /**
   * –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
   */
  private static async scanDirectory(
    dirPath: string, 
    stats: any
  ): Promise<void> {
    try {
      const items = await fs.readdir(dirPath, { withFileTypes: true })
      
      for (const item of items) {
        const itemPath = path.join(dirPath, item.name)
        
        if (item.isDirectory()) {
          await this.scanDirectory(itemPath, stats)
        } else if (item.isFile()) {
          const fileStats = await fs.stat(itemPath)
          const ext = path.extname(item.name).toLowerCase()
          
          stats.totalFiles++
          stats.totalSize += fileStats.size
          
          // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º
          if (!stats.byType[ext]) {
            stats.byType[ext] = { count: 0, size: 0 }
          }
          stats.byType[ext].count++
          stats.byType[ext].size += fileStats.size
          
          // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–∞—Ç–∞–º
          const dateStr = fileStats.mtime.toISOString().split('T')[0]
          if (!stats.byDate[dateStr]) {
            stats.byDate[dateStr] = { count: 0, size: 0 }
          }
          stats.byDate[dateStr].count++
          stats.byDate[dateStr].size += fileStats.size
        }
      }
    } catch (error) {
      // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –¥–æ—Å—Ç—É–ø–∞
      console.warn(`Cannot scan directory ${dirPath}:`, error)
    }
  }
}
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
```typescript
// 1. –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –ø–∞–ø–∫—É
const tempPath = await FileUtils.createTempFolder()

// 2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
const validation = FileUtils.validateFile(uploadedFile)
if (!validation.valid) {
  throw new Error(validation.error)
}

// 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É
const fileInfo = await FileManager.saveUploadedFile(
  tempPath,
  uploadedFile.originalname,
  uploadedFile.mimetype
)
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞
```typescript
// 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
const text = await extractTextFromFile(fileInfo.filePath)

// 2. –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —á–∞–Ω–∫–∏
const chunks = splitTextIntoChunks(text)

// 3. –°–æ–∑–¥–∞–Ω–∏–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
const embeddings = await Promise.all(
  chunks.map(chunk => getEmbedding(chunk.content))
)

// 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Qdrant
const qdrantPoints = await saveToQdrant(chunks, embeddings)
```

### 3. –û—á–∏—Å—Ç–∫–∞
```typescript
// 1. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
await FileUtils.deleteFile(tempPath)

// 2. –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
const cleanup = await FileManager.cleanupOldFiles()
console.log(`Cleaned up ${cleanup.deletedFiles} files, freed ${cleanup.freedSpace} bytes`)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –¢–µ—Å—Ç—ã —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
```typescript
describe('FileManager', () => {
  test('should save uploaded file', async () => {
    const tempPath = '/tmp/test.pdf'
    const result = await FileManager.saveUploadedFile(
      tempPath,
      'test.pdf',
      'application/pdf'
    )
    
    expect(result.filename).toMatch(/test_.*\.pdf/)
    expect(result.fileHash).toBeDefined()
  })
})
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
```typescript
export class FileLogger {
  static async logUpload(fileInfo: any): Promise<void> {
    const logEntry = {
      timestamp: new Date().toISOString(),
      action: 'upload',
      fileId: fileInfo.id,
      filename: fileInfo.filename,
      size: fileInfo.fileSize
    }
    
    await fs.appendFile(
      path.join(FILE_CONFIG.LOGS_DIR, 'uploads.log'),
      JSON.stringify(logEntry) + '\n'
    )
  }
}
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–ø–æ–∫
mkdir -p uploads/{temp/{processing,cleanup},backups,logs}

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 755 uploads
chmod 755 uploads/temp
chmod 755 uploads/backups
chmod 755 uploads/logs
```

### 2. Cron –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
```bash
# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * /usr/bin/node /path/to/cleanup-script.js

# –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 1:00
0 1 * * * /usr/bin/node /path/to/backup-script.js
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FileUtils
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å FileManager
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ñ–∞–π–ª–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –æ—á–∏—Å—Ç–∫–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –∑–∞–¥–∞—á–∏ 
